{% extends "base.html" %}

{% block content %}
<!-- 搜索头部 -->
<section class="bg-gradient-to-br from-gray-900 via-gray-800 to-emerald-900 py-12">
  <div class="container-custom">
    <form action="/search" method="GET" class="max-w-2xl mx-auto">
      <div class="relative">
        <input
          type="search"
          name="q"
          value="{{ keyword |default:'' }}"
          placeholder="搜索项目、文章、案例..."
          class="w-full pl-12 pr-4 py-4 rounded-full text-lg border-2 border-transparent focus:border-primary focus:ring-0"
          autofocus
        >
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
    </form>
  </div>
</section>

<!-- 搜索结果 -->
<section class="section">
  <div class="container-custom">
    {% if keyword and keyword %}
      <!-- 类型筛选 -->
      <div class="flex flex-wrap items-center gap-4 mb-8">
        <span class="text-secondary">筛选：</span>
        <div class="flex gap-2">
          <a href="/search?q={{ keyword }}" class="px-4 py-2 rounded-full text-sm font-medium transition-colors {% if not search_type %}bg-primary text-white{% else %}bg-gray-100 text-secondary hover:bg-gray-200{% endif %}">
            全部
          </a>
          <a href="/search?q={{ keyword }}&type=project" class="px-4 py-2 rounded-full text-sm font-medium transition-colors {% if search_type == 'project' %}bg-primary text-white{% else %}bg-gray-100 text-secondary hover:bg-gray-200{% endif %}">
            产品
          </a>
          <a href="/search?q={{ keyword }}&type=article" class="px-4 py-2 rounded-full text-sm font-medium transition-colors {% if search_type == 'article' %}bg-primary text-white{% else %}bg-gray-100 text-secondary hover:bg-gray-200{% endif %}">
            文章
          </a>
          <a href="/search?q={{ keyword }}&type=case" class="px-4 py-2 rounded-full text-sm font-medium transition-colors {% if search_type == 'case' %}bg-primary text-white{% else %}bg-gray-100 text-secondary hover:bg-gray-200{% endif %}">
            案例
          </a>
        </div>

        {% if total %}
          <span class="ml-auto text-secondary text-sm">
            共找到 <strong class="text-primary">{{ total }}</strong> 条结果
          </span>
        {% endif %}
      </div>

      <!-- 结果列表 -->
      {% if results and results | length > 0 %}
        <div class="space-y-6">
          {% for result in results %}
            <article class="card-tech" data-aos="fade-up">
              <div class="flex items-start gap-4">
                <!-- 类型图标 -->
                <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0
                  {% if result.type == 'project' %}bg-blue-100 text-blue-600{% endif %}
                  {% if result.type == 'article' %}bg-green-100 text-green-600{% endif %}
                  {% if result.type == 'case' %}bg-purple-100 text-purple-600{% endif %}
                ">
                  {% if result.type == 'project' %}
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                  {% elif result.type == 'article' %}
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2 2 0 00-2-2h-2"></path>
                    </svg>
                  {% elif result.type == 'case' %}
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                  {% endif %}
                </div>

                <div class="flex-1 min-w-0">
                  <!-- 标题 -->
                  <h3 class="text-lg font-semibold mb-1">
                    <a href="{{ result.url }}" class="hover:text-primary transition-colors">
                      {{ result.title | highlight:keyword | safe }}
                    </a>
                  </h3>

                  <!-- 摘要 -->
                  <p class="text-secondary text-sm mb-2 line-clamp-2">
                    {{ result.excerpt | highlight:keyword | safe }}
                  </p>

                  <!-- 元信息 -->
                  <div class="flex items-center gap-4 text-xs text-tertiary">
                    <span class="capitalize">{{ result.type }}</span>
                    {% if result.date %}
                      <span>{{ result.date | format_date }}</span>
                    {% endif %}
                  </div>
                </div>
              </div>
            </article>
          {% endfor %}
        </div>

        {% include "components/pagination.html" %}
      {% else %}
        {% set empty_icon = "search" %}
        {% set empty_title = "未找到相关结果" %}
        {% set empty_description = "尝试使用不同的关键词或减少筛选条件" %}
        {% include "components/empty-state.html" %}
      {% endif %}
    {% else %}
      <!-- 没有关键词时的提示 -->
      <div class="text-center py-16">
        <svg class="w-24 h-24 text-gray-300 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <h2 class="text-xl font-semibold text-secondary mb-2">输入关键词开始搜索</h2>
        <p class="text-tertiary">您可以搜索产品、文章、案例等内容</p>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
